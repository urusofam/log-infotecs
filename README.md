# log-infotecs
Библиотека для записи сообщений в журнал с разными уровнями важности и приложения, демонстрирующие работу библиотеки.

## Описание
Проект состоит из:
- **Библиотеки логирования** (`loggerLib`) с поддержкой файлового и сокет логера (1 часть тестового задания)
- **Приложения для записи логов** (`log_writer`) с интерактивным вводом логов в консоль (2 часть тестового задания)
- **Приложения сбора статистики** (`log_stats`) для анализа логов в реальном времени из сокета (3 часть тестового задания)

## Возможности
### Библиотека логирования
- **Уровни логирования**: Error, Warning, Info
- **Два типа логгеров**:
  - `FileLogger` - запись в файл
  - `SocketLogger` - запись в сокет
- **Потокобезопасность** - все операции защищены мьютексами
- **Фабричный паттерн** для создания логеров

### Приложение log_writer
- Интерактивный ввод логов через консоль
- Поддержка префиксов уровней: `[error]`, `[warning]`, `[info]`
- Асинхронная обработка через потокобезопасную очередь
- Поддержка файлового и сокет логера

### Приложение log_stats
- TCP-сервер для приема логов из сокета
- **Статистика в реальном времени**:
  - Общее количество логов
  - Распределение по уровням важности
  - Количество логов за последний час
  - Статистика длины логов (мин/макс/среднее)
- Периодический и пороговый вывод статистики
- Использование epoll для эффективной обработки соединений

## Сборка
### Требования
- CMake 3.21+
- C++17
- pthread
- Linux/Unix система

### Инструкции по сборке
```sh
mkdir build
cd build
cmake ..
make
```

После сборки будут созданы:
- `log_writer` - исполняемый файл приложения для записи логов
- `log_stats` - исполняемый файл приложения сбора статистики
- `unit_tests` - исполняемый файл для запуска тестов

## Использование
### 1. Приложение log_writer
```bash
./log_writer <file|socket> <filename|ip:port> <error|warning|info>
```

**Примеры:**
```bash
# Запись в файл с уровнем info
./log_writer file logs.txt info

# Отправка в сокет с уровнем warning
./log_writer socket 127.0.0.1:6000 warning
```

**Интерактивное использование:**
```
> Привет мир!              # Использует уровень по умолчанию
> [error] Критическая ошибка   # Принудительно уровень error
> [warning] Предупреждение     # Принудительно уровень warning
> [info] Информационное сообщение # Принудительно уровень info
> q                        # Выход
```

### 2. Приоложение статистики log_stats
```bash
./log_stats <ip:port> <N> <T>
```

Где:
- `ip:port` - адрес и порт для прослушивания
- `N` - количество логов для вывода статистики
- `T` - интервал в секундах для периодического вывода

**Пример:**
```bash
./log_stats 127.0.0.1:6000 5 10
```

Приложение будет:
- Слушать на 127.0.0.1:6000
- Выводить статистику каждые 10 логов
- Выводить статистику каждые 30 секунд (если были изменения)

## Формат логов
Все логи сохраняются в формате CSV:
```
сообщение,уровень,временная_метка
```

**Пример:**
```
Приложение запущено,INFO,11-08-2025 14:30:25
Произошла ошибка,ERROR,11-08-2025 14:30:26
```

## Пример работы системы
1. **Запустите приложение статистики log_stats:**
```bash
./log_stats 127.0.0.1:6000 5 10
```

2. **В другом терминале запустите log_writer:**
```bash
./log_writer socket 127.0.0.1:6000 info
```

3. **Вводите сообщения:**
```
> Тестовое сообщение 1
> [error] Критическая ошибка
> [warning] Предупреждение
> Еще одно сообщение
> [info] Информация
```

4. **Наблюдайте статистику в log_stats:**
```
=== Статистика ===
Всего лого: 5
Логи по уровням:
 - INFO: 3
 - ERROR: 1
 - WARNING: 1
Логи за последний час: 5
Длина сообщения (мин/макс/средн): 10 / 25 / 16.4
==================
```

## Архитектура
```
ILogger (интерфейс)
├── FileLogger (запись в файл)
└── SocketLogger (запись в сокет)

LoggerFactory (фабрика логгеров)
ThreadSafeQueue (потокобезопасная очередь)
LogStatsCollector (сборщик статистики)
LogServer (TCP сервер)
```

### Потокобезопасность
- Все логгеры используют мьютексы для синхронизации записи
- `ThreadSafeQueue` обеспечивает безопасную передачу данных между потоками
- Сервер использует epoll для неблокирующей обработки соединений

## Тестирование
Проект включает полный набор unit-тестов для всех основных компонентов.

### Запуск тестов
```bash
# Прямой запуск
./unit_tests

# Или через CTest
ctest --verbose
```

### Покрытие тестами
Тесты покрывают следующие компоненты:

**FileLogger**
- Создание и запись в файл
- Фильтрация по уровням логирования
- Изменение уровня логирования в runtime
- Потокобезопасность записи

**LogStatsCollector**
- Подсчет общего количества логов
- Группировка по уровням важности
- Отслеживание изменений состояния
- Сброс флагов состояния

**ThreadSafeQueue**
- Базовые операции добавления/извлечения
- Поведение при пустой очереди
- Потокобезопасность в многопоточной среде

**LoggerFactory**
- Создание файлового логгера
- Валидация параметров для сетевого логгера
- Обработка неверных входных данных

**ILogger утилиты**
- Преобразование уровней логирования в строки
- Функции работы с временными метками

### Тестовый фреймворк
Для тестирования используется собственный фреймворк без внешних зависимостей, включающий:

- Макросы для утверждений: `ASSERT_TRUE`, `ASSERT_FALSE`, `ASSERT_EQ`, `ASSERT_NE`, `ASSERT_THROWS`
- Автоматический подсчет пройденных/проваленных тестов
- Детальные сообщения об ошибках с номерами строк
- Интеграция с CMake и CTest
